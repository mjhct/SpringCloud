Mind Map generated by NB MindMap plugin   
> __version__=`1.1`
---

# SpringCloud
> align=`center`,collapsed=`true`


## 服务注册中心Eureka

## 负载均衡Ribbon

## 负载均衡Openfeign

## 服务熔断Hystrix

## 服务网关Gateway

## 配置中心Config

## 消息总线Bus

## 消息驱动Stream
> collapsed=`true`


### 概述
> collapsed=`true`


#### 是什么？屏蔽底层消息中间件差异，降低开发维护切换成本，统一消息的编程模型

#### 官方文档：https://cloud\.spring\.io/spring\-cloud\-static/spring\-cloud\-stream/3\.0\.0\.RELEASE/reference/html/<br/>目前支持：RabbitMQ、Kafka（采用示例）
> align=`left`


#### 设计思想

### 生产者
> collapsed=`true`


#### POM
> collapsed=`true`


##### \<dependency\><br/>            \<groupId\>org\.springframework\.cloud\</groupId\><br/>            \<artifactId\>spring\-cloud\-starter\-stream\-kafka\</artifactId\><br/>\</dependency\>
> align=`left`


#### YAML
> collapsed=`true`


##### 在spring\.cloud\.stream下面配置属性，参考官方文档

#### 使用：参考官方文档

### 消费者
> collapsed=`true`


#### 同生产者，参考官方文档

### 消费者分组
> collapsed=`true`


#### 重复消费问题：多个消费者属于不同组，重复消费同一消息。

#### 同组内消费者消费同一主题消息，相互竞争。<br/>不同组消费者消费同一主题消息，重复消费。

#### YAML
> collapsed=`true`


##### spring\.cloud\.stream\.bindings\.input\.group属性配置自定义组名

### 持久化
> collapsed=`true`


#### 消费者未配置组时，在消费者离线时，生产者产生了消息，消费者重启无法获取；即消息丢失。

#### 解决：spring\.cloud\.stream\.bindings\.input\.group属性配置自定义组名。<br/>消费者重启后可以获取到离线期间生产者产生的消息。
> align=`left`


## 链路追踪zipkin
> collapsed=`true`


### 概述：监控服务的调用链路

### POM
> collapsed=`true`


#### \<dependency\><br/>            \<groupId\>org\.springframework\.cloud\</groupId\><br/>            \<artifactId\>spring\-cloud\-starter\-zipkin\</artifactId\><br/>\</dependency\>
> align=`left`


### YAML
> collapsed=`true`


#### spring\.zipkin\.base\-url=http://localhost:9411/<br/>spring\.sleuth\.sampler\.probability=1
> align=`left`


## sentinel

### @SentinelResource<br/>fallback：处理Java异常<br/>blockHandler：处理Sentinel规则
> align=`left`


### 一个请求即触发限流又触发异常，限流处理已经拦截，不会进入降级熔断处理。

### sentinel在nacos中持久化规则配置：<br/>\[<br/>    \{<br/>        "resource": "/feign/data/\{id\}", 资源名称<br/>        "count": 1, 单机阈值<br/>        "grade": 1, 阈值类型：0线程数，1QPS<br/>        "limitApp": "default", 针对来源<br/>        "strategy": 0, 流控模式：0直接，1关联，2链路<br/>        "controlBehavior": 0, 流控效果：0快速失败，1预热，2排队等待<br/>        "clusterMode": false 是否集群<br/>    \}<br/>\]
> align=`left`

